
<!DOCTYPE html>
<html lang="en" data-figures="" class="page">
  <head>
<title>mTLS in the Mesh with Redhat OpenShift Service Mesh (OSSM) - On or Off? | The Wondering Techie</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FE522MLXRL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FE522MLXRL');
</script>

  
<meta property="og:locale" content="en" />

<meta property="og:type" content="article">
<meta name="description" content="The article goes over examples where mTLS configuration on Redhat OpenShift Service Mesh (OSSM) settings do not completely turn off mTLS, when it would be …">
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="@SteliosKousouri">
<meta name="twitter:title" content="mTLS in the Mesh with Redhat OpenShift Service Mesh (OSSM) - On or Off?" />
<meta property="og:url" content="https://www.wonderingtechie.com/post/2022/ossm-mtls-on-or-off/" />
<meta property="og:title" content="mTLS in the Mesh with Redhat OpenShift Service Mesh (OSSM) - On or Off?" />
<meta property="og:description" content="The article goes over examples where mTLS configuration on Redhat OpenShift Service Mesh (OSSM) settings do not completely turn off mTLS, when it would be …" />
<meta property="og:image" content="https://www.wonderingtechie.com/post/2022/ossm-mtls-on-or-off/images/20220510/mTLS-in-the-Mesh-with-OSSM-OnorOff.jpg" />

<link rel="apple-touch-icon" sizes="180x180" href="https://www.wonderingtechie.com/icons/favicon-thewonderingtechie.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.wonderingtechie.com/icons/favicon-thewonderingtechie.png">
<link rel="manifest" href="https://www.wonderingtechie.com/icons/site.webmanifest">

<link rel="canonical" href="https://www.wonderingtechie.com/post/2022/ossm-mtls-on-or-off/">

    

    
    
    <link rel="preload" href="https://www.wonderingtechie.com/css/styles.f143f2039d975cd60c5524f52c5fbb6dd2236d44d0d53d71b5cb6f6127d4fe8082960bbb71fe0345b5bab4119124e0b09c0b7d7f4238a9288afc02815d258f76.css" integrity = "sha512-8UPyA52XXNYMVST1LF&#43;7bdIjbUTQ1T1xtctvYSfU/oCClgu7cf4DRbW6tBGRJOCwnAt9f0I4qSiK/AKBXSWPdg==" as="style" crossorigin="anonymous">
    <link rel="preload" href="https://www.wonderingtechie.com/js/bundle.min.38de1519efd9f00810f37ccedfa6aa9db3c9e361f8a8d81b181268bcab092ae8382d9648a9e95dd34c9ec5b39af512289496224f286cd45115ef11ac40b34d7a.js" as="script" integrity=
    "sha512-ON4VGe/Z8AgQ83zO36aqnbPJ42H4qNgbGBJovKsJKug4LZZIqeld00yexbOa9RIolJYiTyhs1FEV7xGsQLNNeg==" crossorigin="anonymous">

    
    <link rel="stylesheet" type="text/css" href="https://www.wonderingtechie.com/css/styles.f143f2039d975cd60c5524f52c5fbb6dd2236d44d0d53d71b5cb6f6127d4fe8082960bbb71fe0345b5bab4119124e0b09c0b7d7f4238a9288afc02815d258f76.css" integrity="sha512-8UPyA52XXNYMVST1LF&#43;7bdIjbUTQ1T1xtctvYSfU/oCClgu7cf4DRbW6tBGRJOCwnAt9f0I4qSiK/AKBXSWPdg==" crossorigin="anonymous">
    
  </head>
  
  
    
  
  <body data-code="7" data-lines="false" id="documentTop">

<header class="nav_header" >
  <nav class="nav"><a href='https://www.wonderingtechie.com/' class="nav_brand nav_item" title="The Wondering Techie">
  <img src="https://www.wonderingtechie.com/logos/logo.png" class="logo" alt="The Wondering Techie">
  <div class="nav_close">
    <div><svg class="icon">
  <use xlink:href="#open-menu"></use>
</svg><svg class="icon">
  <use xlink:href="#closeme"></use>
</svg></div>
  </div>
</a>

    <div class='nav_body nav_body_left'>
      
      
      
        

  <div class="nav_parent">
    <a href="https://www.wonderingtechie.com/" class="nav_item" title="Home">Home </a>
  </div>
  <div class="nav_parent">
    <a href="https://www.wonderingtechie.com/about/" class="nav_item" title="About">About </a>
  </div>
      
<div class='follow'>
  <a href="https://github.com/skoussou">
    <svg class="icon">
  <use xlink:href="#github"></use>
</svg>
  </a>
  <a href="https://twitter.com/SteliosKousouri">
    <svg class="icon">
  <use xlink:href="#twitter"></use>
</svg>
  </a>
  <a href="https://www.linkedin.com/in/stelioskoussouris">
    <svg class="icon">
  <use xlink:href="#linkedin"></use>
</svg>
  </a>
    
  <a href="https://www.wonderingtechie.com/index.xml">
    <svg class="icon">
  <use xlink:href="#rss"></use>
</svg>
  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">mTLS in the Mesh with Redhat OpenShift Service Mesh (OSSM) - On or Off?</h1>
  <div class="post_meta">
    <span><svg class="icon">
  <use xlink:href="#calendar"></use>
</svg></span>
    <span class="post_date">
      May 10, 2022</span>
    <span class="post_time"> · 9 min read</span><span>&nbsp;· <a href='https://www.wonderingtechie.com/tags/ossm' title="ossm" class="post_tag button button_translucent">ossm
        </a><a href='https://www.wonderingtechie.com/tags/servicemesh' title="ServiceMesh" class="post_tag button button_translucent">ServiceMesh
        </a><a href='https://www.wonderingtechie.com/tags/openshift' title="OpenShift" class="post_tag button button_translucent">OpenShift
        </a>
    </span>
    <span class="page_only">&nbsp;·
  <div class="post_share">
    Share on:
    <a href="https://twitter.com/intent/tweet?text=mTLS%20in%20the%20Mesh%20with%20Redhat%20OpenShift%20Service%20Mesh%20%28OSSM%29%20-%20On%20or%20Off%3f&url=https%3a%2f%2fwww.wonderingtechie.com%2fpost%2f2022%2fossm-mtls-on-or-off%2f&tw_p=tweetbutton" class="twitter" title="Share on Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#twitter"></use>
</svg>
    </a>
    <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.wonderingtechie.com%2fpost%2f2022%2fossm-mtls-on-or-off%2f&t=mTLS%20in%20the%20Mesh%20with%20Redhat%20OpenShift%20Service%20Mesh%20%28OSSM%29%20-%20On%20or%20Off%3f" class="facebook" title="Share on Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#facebook"></use>
</svg>
    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Share on LinkedIn" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#linkedin"></use>
</svg>
    </a>
    <a href="https://www.wonderingtechie.com/post/2022/ossm-mtls-on-or-off/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <use xlink:href="#copy"></use>
</svg>
    </a>
  </div>
  </span>
  </div>
<div class="post_featured">









  
    
  

  
    
  

  

  

  

  





  


  









<figure>
    <picture>

        
          
          
          
          
          
          
          
          
          
          
          
          
        
          
          
          
          
          
          
          
          
          
          
          
          
        
          
          
          
          
          
          
          
          
          
          
          
          
        

        <img class="image_figure image_featured image_internal" src="https://www.wonderingtechie.com/images/20220510/mTLS-in-the-Mesh-with-OSSM-OnorOff.jpg" alt="" loading="lazy" decoding="async" width="4496" height="3000"  />
      

    </picture>
  </figure>


      </div>
    <div class="post_toc">
      <h2>Overview</h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#setting-up-the-service-mesh-controlplane">Setting up the Service Mesh controlplane</a></li>
    <li><a href="#setting-up-the-dataplane">Setting up the dataplane</a></li>
    <li><a href="#disabling-mtls-for-all-applications">Disabling mTLS for all applications</a></li>
    <li><a href="#enforce-mtls-for-all-applications">Enforce mTLS for all applications</a></li>
    <li><a href="#mtls-disabled-for-specific-application-workloads">mTLS disabled for specific application workloads</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
    
    <div class="post_body"><h2 id="introduction">Introduction</h2>
<p>One of the benefits of a service mesh is security by design, in fact it is one of the main use cases which drives adoption of the mesh in cloud based environments where there are disparate types of microservice workloads.</p>
<p>Although this is very powerful as one can imagine there may be cases that a workload cannot participate in mTLS handshakes using the default mesh certificates. This is due to a workload having to handle its own TLS termination or because simply it should not receive TLS traffic (performance or policy reasons). However, what are the possible security settings and when do they result in an <strong>on</strong> or <strong>off</strong> mTLS traffic setup? Like in the case of a recent customer of mine this can be a little confusing.</p>
<p>In this article we will explore how encryption with Mutual TLS (mTLS) is configured <strong>on</strong> or <strong>off</strong> in <a href="https://www.redhat.com/en/technologies/cloud-computing/openshift/what-is-openshift-service-mesh">Red Hat OpenShift Service Mesh (OSSM)</a> and how you can verify if the traffic is encrypted or not.</p>
<h2 id="setting-up-the-service-mesh-controlplane">Setting up the Service Mesh controlplane</h2>
<p>In order to setup the Red Hat Service Mesh you would need either a</p>
<ul>
<li>Local <a href="https://access.redhat.com/documentation/en-us/red_hat_codeready_containers/1.34/html/getting_started_guide">CodeReady Containers (CRC)</a> cluster or</li>
<li>an <a href="https://www.redhat.com/en/technologies/cloud-computing/openshift/try-it">OpenShift Clusters (4.6+)</a>
and</li>
<li><code>oc</code> <a href="https://downloads-openshift-console.apps.cluster-wwt8j.wwt8j.sandbox1899.opentlc.com/">binary</a> installed in the local path for the version of OCP</li>
</ul>
<p>The next step is to deploy in the cluster the necessary <a href="https://docs.openshift.com/container-platform/4.9/service_mesh/v2x/installing-ossm.html">operators the service OSSM requires</a> for the deployment and configuration of the mesh. We have prepared such a script <a href="https://github.com/skoussou/servicemesh-playground/blob/main/scripts/add-operators-subscriptions-sm.sh"><code>add-operators-subscriptions-sm.sh</code></a> and all you require is to login to your cluster and execute (in a linux based system) this script or alternatively copy the contents of it and execute them with the <code>oc</code> binary.</p>
<p>Finally, the OSSM operator will require a <code>ServiceMeshControlPlane</code> (SMCP) resource to define the characteristics of the Service Mesh (both for the <em>controlplane</em> and <em>dataplane</em>). We will create it with the following commands.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line hl"><span class="ln"> 0</span><span class="cl"><span class="nx">oc</span> <span class="nx">new</span><span class="o">-</span><span class="nx">project</span> <span class="nx">istio</span><span class="o">-</span><span class="nf">system</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line hl"><span class="ln"> 1</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: maistra.io/v2 (2)
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="s">kind: ServiceMeshControlPlane
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s">  name: basic
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="s">  namespace: istio-system
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="s">  security:
</span></span></span><span class="line hl"><span class="ln"> 8</span><span class="cl"><span class="s">    dataPlane:
</span></span></span><span class="line hl"><span class="ln"> 9</span><span class="cl"><span class="s">      automtls: false
</span></span></span><span class="line hl"><span class="ln">10</span><span class="cl"><span class="s">      mtls: false
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="s">  addons:
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="s">    grafana:
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="s">      enabled: true
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="s">    jaeger:
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="s">      install:
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="s">        storage:
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="s">          type: Memory
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="s">    kiali:
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="s">      enabled: true
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="s">    prometheus:
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="s">      enabled: true
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="s">  policy:
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="s">    type: Istiod
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="s">  profiles:
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="s">    - default
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="s">  telemetry:
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="s">    type: Istiod
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="s">  tracing:
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="s">    sampling: 10000
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="s">    type: Jaeger
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="s">  version: v2.1&#34;</span><span class="p">|</span> <span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">istio</span><span class="o">-</span><span class="nx">system</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="nx">oc</span> <span class="nx">get</span> <span class="nx">smcp</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">istio</span><span class="o">-</span><span class="nx">system</span>
</span></span><span class="line hl"><span class="ln">34</span><span class="cl"><span class="nx">NAME</span>    <span class="nx">READY</span>   <span class="nx">STATUS</span>           <span class="nx">PROFILES</span>      <span class="nx">VERSION</span>   <span class="nf">AGE</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="nx">basic</span>   <span class="mi">7</span><span class="o">/</span><span class="mi">10</span>    <span class="nx">PausingInstall</span>   <span class="p">[</span><span class="s">&#34;default&#34;</span><span class="p">]</span>             <span class="mi">18</span><span class="nx">s</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">
</span></span><span class="line hl"><span class="ln">37</span><span class="cl"><span class="nx">oc</span> <span class="nx">wait</span> <span class="o">--</span><span class="k">for</span> <span class="nx">condition</span><span class="p">=</span><span class="nx">Ready</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">istio</span><span class="o">-</span><span class="nx">system</span> <span class="nx">smcp</span><span class="o">/</span><span class="nx">basic</span> <span class="o">--</span><span class="nx">timeout</span> <span class="mi">300</span><span class="nf">s</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="nx">servicemeshcontrolplane</span><span class="p">.</span><span class="nx">maistra</span><span class="p">.</span><span class="nx">io</span><span class="o">/</span><span class="nx">basic</span> <span class="nx">condition</span> <span class="nx">met</span></span></span></code></pre></div>
<ol>
<li>Creates the OCP namespace (project) where the controlplane components will be deployed in.</li>
<li>The <code>SMCP</code> which defines that dataplane <strong>mTLS</strong> (mutual TLS encryption between mesh included workloads) is <strong>false</strong>. It is key to understand what the effect of this is and we will explain it below.</li>
<li>The OSSM operator begins to configure the controlplane and when all components are ready it is ready (STATUS: <code>ComponentsReady</code>) to be used</li>
<li>The OSSM operator begins to configure the controlplane and when conditions are met it is ready to be used</li>
</ol>
<p>After applying the above we will have a Service Mesh <em>controlplane</em> which manages the observability stack as well as policies and configurations applied to the <em>dataplane</em> and we now need to define the <em>dataplane</em>.</p>
<h2 id="setting-up-the-dataplane">Setting up the dataplane</h2>
<p>Next apply the commands in the following link to create a namespace and deploy the bookinfo <a href="https://github.com/skoussou/servicemesh-playground/tree/main/Scenario-0-Deploy-In-ServiceMesh#bookinfo">application</a>. Once that is in place you should have all PODs in the bookinfo namespace started.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln">0</span><span class="cl"><span class="nx">oc</span> <span class="nx">get</span> <span class="nx">pods</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">NAME</span>                              <span class="nx">READY</span>   <span class="nx">STATUS</span>    <span class="nx">RESTARTS</span>   <span class="nx">AGE</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nx">details</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">6</span><span class="nx">cd699df8c</span><span class="o">-</span><span class="nx">nnbtx</span>       <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>     <span class="nx">Running</span>   <span class="mi">0</span>          <span class="mi">14</span><span class="nx">s</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="nx">productpage</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">5</span><span class="nx">ddcb4b84f</span><span class="o">-</span><span class="mi">6</span><span class="nx">jlf8</span>   <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>     <span class="nx">Running</span>   <span class="mi">0</span>          <span class="mi">9</span><span class="nx">s</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="nx">ratings</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="nx">bdbcc68bc</span><span class="o">-</span><span class="mi">7</span><span class="nx">vjtj</span>        <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>     <span class="nx">Running</span>   <span class="mi">0</span>          <span class="mi">13</span><span class="nx">s</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="nx">reviews</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">754</span><span class="nx">ddd7b6f</span><span class="o">-</span><span class="nx">d4xxj</span>       <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>     <span class="nx">Running</span>   <span class="mi">0</span>          <span class="mi">12</span><span class="nx">s</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">reviews</span><span class="o">-</span><span class="nx">v2</span><span class="o">-</span><span class="mi">675679877</span><span class="nx">f</span><span class="o">-</span><span class="nx">b78qm</span>       <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>     <span class="nx">Running</span>   <span class="mi">0</span>          <span class="mi">12</span><span class="nx">s</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="nx">reviews</span><span class="o">-</span><span class="nx">v3</span><span class="o">-</span><span class="mi">79</span><span class="nx">d7549c7</span><span class="o">-</span><span class="nx">xdsjj</span>        <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>     <span class="nx">Running</span>   <span class="mi">0</span>          <span class="mi">11</span><span class="nx">s</span></span></span></code></pre></div>
<p>Add to each of the <code>Deployment</code> under <code>bookinfo</code> namespace the following annotation in order to register statistics by <code>istio-proxy</code> on TLS handshakes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln">0</span><span class="cl"><span class="nx">oc</span> <span class="nx">patch</span> <span class="nx">deployment</span> <span class="nx">productpage</span><span class="o">-</span><span class="nx">v1</span> <span class="o">-</span><span class="nx">p</span> <span class="err">&#39;</span><span class="p">{</span><span class="s">&#34;spec&#34;</span><span class="p">:{</span><span class="s">&#34;template&#34;</span><span class="p">:{</span><span class="s">&#34;metadata&#34;</span><span class="p">:{</span><span class="s">&#34;annotations&#34;</span><span class="p">:{</span><span class="s">&#34;sidecar.istio.io/statsInclusionPrefixes&#34;</span><span class="p">:</span> <span class="s">&#34;tls_inspector,listener,cluster&#34;</span><span class="p">}}}}}</span><span class="err">&#39;</span> <span class="o">-</span><span class="nx">n</span>  <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">oc</span> <span class="nx">patch</span> <span class="nx">deployment</span> <span class="nx">details</span><span class="o">-</span><span class="nx">v1</span> <span class="o">-</span><span class="nx">p</span> <span class="err">&#39;</span><span class="p">{</span><span class="s">&#34;spec&#34;</span><span class="p">:{</span><span class="s">&#34;template&#34;</span><span class="p">:{</span><span class="s">&#34;metadata&#34;</span><span class="p">:{</span><span class="s">&#34;annotations&#34;</span><span class="p">:{</span><span class="s">&#34;sidecar.istio.io/statsInclusionPrefixes&#34;</span><span class="p">:</span> <span class="s">&#34;tls_inspector,listener,cluster&#34;</span><span class="p">}}}}}</span><span class="err">&#39;</span> <span class="o">-</span><span class="nx">n</span>  <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nx">oc</span> <span class="nx">patch</span> <span class="nx">deployment</span> <span class="nx">ratings</span><span class="o">-</span><span class="nx">v1</span> <span class="o">-</span><span class="nx">p</span> <span class="err">&#39;</span><span class="p">{</span><span class="s">&#34;spec&#34;</span><span class="p">:{</span><span class="s">&#34;template&#34;</span><span class="p">:{</span><span class="s">&#34;metadata&#34;</span><span class="p">:{</span><span class="s">&#34;annotations&#34;</span><span class="p">:{</span><span class="s">&#34;sidecar.istio.io/statsInclusionPrefixes&#34;</span><span class="p">:</span> <span class="s">&#34;tls_inspector,listener,cluster&#34;</span><span class="p">}}}}}</span><span class="err">&#39;</span> <span class="o">-</span><span class="nx">n</span>  <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="nx">oc</span> <span class="nx">patch</span> <span class="nx">deployment</span> <span class="nx">reviews</span><span class="o">-</span><span class="nx">v1</span> <span class="o">-</span><span class="nx">p</span> <span class="err">&#39;</span><span class="p">{</span><span class="s">&#34;spec&#34;</span><span class="p">:{</span><span class="s">&#34;template&#34;</span><span class="p">:{</span><span class="s">&#34;metadata&#34;</span><span class="p">:{</span><span class="s">&#34;annotations&#34;</span><span class="p">:{</span><span class="s">&#34;sidecar.istio.io/statsInclusionPrefixes&#34;</span><span class="p">:</span> <span class="s">&#34;tls_inspector,listener,cluster&#34;</span><span class="p">}}}}}</span><span class="err">&#39;</span> <span class="o">-</span><span class="nx">n</span>  <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="nx">oc</span> <span class="nx">patch</span> <span class="nx">deployment</span> <span class="nx">reviews</span><span class="o">-</span><span class="nx">v2</span> <span class="o">-</span><span class="nx">p</span> <span class="err">&#39;</span><span class="p">{</span><span class="s">&#34;spec&#34;</span><span class="p">:{</span><span class="s">&#34;template&#34;</span><span class="p">:{</span><span class="s">&#34;metadata&#34;</span><span class="p">:{</span><span class="s">&#34;annotations&#34;</span><span class="p">:{</span><span class="s">&#34;sidecar.istio.io/statsInclusionPrefixes&#34;</span><span class="p">:</span> <span class="s">&#34;tls_inspector,listener,cluster&#34;</span><span class="p">}}}}}</span><span class="err">&#39;</span> <span class="o">-</span><span class="nx">n</span>  <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="nx">oc</span> <span class="nx">patch</span> <span class="nx">deployment</span> <span class="nx">reviews</span><span class="o">-</span><span class="nx">v3</span> <span class="o">-</span><span class="nx">p</span> <span class="err">&#39;</span><span class="p">{</span><span class="s">&#34;spec&#34;</span><span class="p">:{</span><span class="s">&#34;template&#34;</span><span class="p">:{</span><span class="s">&#34;metadata&#34;</span><span class="p">:{</span><span class="s">&#34;annotations&#34;</span><span class="p">:{</span><span class="s">&#34;sidecar.istio.io/statsInclusionPrefixes&#34;</span><span class="p">:</span> <span class="s">&#34;tls_inspector,listener,cluster&#34;</span><span class="p">}}}}}</span><span class="err">&#39;</span> <span class="o">-</span><span class="nx">n</span>  <span class="nx">bookinfo</span></span></span></code></pre></div>
<p>As soon as the re-deployment of the PODs completes the <em>dataplane</em> is ready and the following command should verify this.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln">0</span><span class="cl"><span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="s">&#34;http://$(oc get route istio-ingressgateway -o jsonpath=&#39;{.spec.host}&#39; -n istio-system)/productpage&#34;</span> <span class="p">|</span> <span class="nx">grep</span> <span class="o">-</span><span class="nx">o</span> <span class="s">&#34;&lt;title&gt;.*&lt;/title&gt;&#34;</span>
</span></span><span class="line hl"><span class="ln">1</span><span class="cl"><span class="p">&lt;</span><span class="nx">title</span><span class="p">&gt;</span><span class="nx">Simple</span> <span class="nx">Bookstore</span> <span class="nx">App</span><span class="p">&lt;</span><span class="o">/</span><span class="nx">title</span><span class="p">&gt;</span></span></span></code></pre></div>
<h2 id="disabling-mtls-for-all-applications">Disabling mTLS for all applications</h2>
<p>As mentioned above we need to have a clear understanding of the <code>SMCP</code> mTLS settings and their effect. The result of the above applied settings for <code>mtls: false</code> is that OSSM creates in the <em>controlplane</em> namespace a <code>PeerAuthentication</code> resource with mTLS mode set to <code>PERMISSIVE</code>. The effect of this configuration is that if 2 workloads participating in communication in the mesh can perform mTLS handshake then the mesh will enforce it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln">0</span><span class="cl"><span class="nx">oc</span> <span class="nx">get</span> <span class="nx">peerauthentication</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">istio</span><span class="o">-</span><span class="nx">system</span>
</span></span><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">NAME</span>          <span class="nx">MODE</span>         <span class="nx">AGE</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">default</span>       <span class="nx">PERMISSIVE</span>   <span class="mi">5</span><span class="nx">d18h</span></span></span></code></pre></div>
<p>This is then inherited by all <em>dataplane</em> namespaces and this came as a surprise to one of our customers who expected that <code>mtls: false</code> meant no mTLS handshakes.</p>
<p>You can verify this whilst calling the URL</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln">0</span><span class="cl"><span class="nx">watch</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">s</span> <span class="s">&#34;http://$(oc get route istio-ingressgateway -o jsonpath=&#39;{.spec.host}&#39; -n istio-system)/productpage&#34;</span> <span class="p">|</span> <span class="nx">grep</span> <span class="o">-</span><span class="nx">o</span> <span class="s">&#34;&lt;title&gt;.*&lt;/title&gt;&#34;</span></span></span></code></pre></div>
<p>TLS handshakes will take place between the components and statistics will be registered in the counters (see the numbers on the stats increasing executing the <a href="https://github.com/skoussou/servicemesh-playground/blob/main/Scenario-MTLS-4-Turn-Off-MTLS/test-ssl-handshakes.sh">test-ssl-handshakes.sh</a> script per POD).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln">0</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">productpage</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">556</span><span class="nx">db7cbb5</span><span class="o">-</span><span class="nx">x5n55</span>	<span class="o">&lt;--</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">1</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">details</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">68</span><span class="nx">cbd47bc5</span><span class="o">-</span><span class="nx">xwf2x</span>		<span class="o">&lt;--</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">reviews</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">75755</span><span class="nx">d569f</span><span class="o">-</span><span class="nx">z6jwf</span>		<span class="o">&lt;--</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">reviews</span><span class="o">-</span><span class="nx">v2</span><span class="o">-</span><span class="mi">86</span><span class="nx">c76b84c5</span><span class="o">-</span><span class="nx">xzq56</span>		<span class="o">&lt;--</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">reviews</span><span class="o">-</span><span class="nx">v3</span><span class="o">-</span><span class="mi">56</span><span class="nx">cbff6b99</span><span class="o">-</span><span class="nx">cfwj4</span>		<span class="o">&lt;--</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">ratings</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">5</span><span class="nx">f867c4bb7</span><span class="o">-</span><span class="mi">7</span><span class="nx">fdv8</span>		<span class="o">&lt;--</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span></span></span></code></pre></div>
<p>You can further verify this by accessing the KIALI UI (url: <code>oc get route kiali -o jsonpath='{.spec.host}' -n istio-system</code>) <em>App Graph</em> and in the display drop down select <em>Security</em>. You should note the padlock icon appears in all the arrows between the <code>bookinfo</code> components.</p>
<p>So how can we then completely disable mTLS in the communications for the traffic in the <em>dataplane</em>? The answer is by applying <code>DestinationRule</code> which forces clients of a service (host) to not apply mTLS in the communication towards/from that host. This is what the following commands will do after you apply them.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln"> 0</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: networking.istio.io/v1beta1
</span></span></span><span class="line"><span class="ln"> 1</span><span class="cl"><span class="s">kind: DestinationRule
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s">  name: productpage
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="s">  host: productpage.bookinfo.svc.cluster.local
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="s">  trafficPolicy:
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="s">    tls:
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="s">      mode: DISABLE&#34;</span> <span class="p">|</span><span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: networking.istio.io/v1beta1
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="s">kind: DestinationRule
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="s">  name: productpage-2
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="s">  host: productpage
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="s">  trafficPolicy:
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="s">    tls:
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="s">      mode: DISABLE&#34;</span> <span class="p">|</span><span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: networking.istio.io/v1beta1
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="s">kind: DestinationRule
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="s">  name: details
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="s">  host: details.bookinfo.svc.cluster.local
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="s">  trafficPolicy:
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="s">    tls:
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="s">      mode: DISABLE&#34;</span> <span class="p">|</span><span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: networking.istio.io/v1beta1
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="s">kind: DestinationRule
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="s">  name: details-2
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="s">  host: details
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="s">  trafficPolicy:
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="s">    tls:
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="s">      mode: DISABLE&#34;</span> <span class="p">|</span><span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: networking.istio.io/v1beta1
</span></span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="s">kind: DestinationRule
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="s">  name: ratings
</span></span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="s">  host: ratings.bookinfo.svc.cluster.local
</span></span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="s">  trafficPolicy:
</span></span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="s">    tls:
</span></span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="s">      mode: DISABLE&#34;</span> <span class="p">|</span><span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: networking.istio.io/v1beta1
</span></span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="s">kind: DestinationRule
</span></span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="s">  name: ratings-2
</span></span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="s">  host: ratings
</span></span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="s">  trafficPolicy:
</span></span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="s">    tls:
</span></span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="s">      mode: DISABLE&#34;</span> <span class="p">|</span><span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: networking.istio.io/v1beta1
</span></span></span><span class="line"><span class="ln">61</span><span class="cl"><span class="s">kind: DestinationRule
</span></span></span><span class="line"><span class="ln">62</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln">63</span><span class="cl"><span class="s">  name: reviews
</span></span></span><span class="line"><span class="ln">64</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln">65</span><span class="cl"><span class="s">  host: reviews.bookinfo.svc.cluster.local
</span></span></span><span class="line"><span class="ln">66</span><span class="cl"><span class="s">  trafficPolicy:
</span></span></span><span class="line"><span class="ln">67</span><span class="cl"><span class="s">    tls:
</span></span></span><span class="line"><span class="ln">68</span><span class="cl"><span class="s">      mode: DISABLE&#34;</span> <span class="p">|</span><span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">
</span></span><span class="line"><span class="ln">70</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: networking.istio.io/v1beta1
</span></span></span><span class="line"><span class="ln">71</span><span class="cl"><span class="s">kind: DestinationRule
</span></span></span><span class="line"><span class="ln">72</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln">73</span><span class="cl"><span class="s">  name: reviews-2
</span></span></span><span class="line"><span class="ln">74</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln">75</span><span class="cl"><span class="s">  host: reviews
</span></span></span><span class="line"><span class="ln">76</span><span class="cl"><span class="s">  trafficPolicy:
</span></span></span><span class="line"><span class="ln">77</span><span class="cl"><span class="s">    tls:
</span></span></span><span class="line"><span class="ln">78</span><span class="cl"><span class="s">      mode: DISABLE&#34;</span> <span class="p">|</span><span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span></span></span></code></pre></div>
<p>Testing against the <code>productpage</code> application (curl above) we should see no TLS handshakes taking place now.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln">0</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">productpage</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">556</span><span class="nx">db7cbb5</span><span class="o">-</span><span class="nx">x5n55</span>	<span class="o">&lt;--</span> <span class="nx">NO</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">1</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">details</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">68</span><span class="nx">cbd47bc5</span><span class="o">-</span><span class="nx">xwf2x</span>		<span class="o">&lt;--</span> <span class="nx">NO</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">reviews</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">75755</span><span class="nx">d569f</span><span class="o">-</span><span class="nx">z6jwf</span>		<span class="o">&lt;--</span> <span class="nx">NO</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">reviews</span><span class="o">-</span><span class="nx">v2</span><span class="o">-</span><span class="mi">86</span><span class="nx">c76b84c5</span><span class="o">-</span><span class="nx">xzq56</span>		<span class="o">&lt;--</span> <span class="nx">NO</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">reviews</span><span class="o">-</span><span class="nx">v3</span><span class="o">-</span><span class="mi">56</span><span class="nx">cbff6b99</span><span class="o">-</span><span class="nx">cfwj4</span>		<span class="o">&lt;--</span> <span class="nx">NO</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">.</span><span class="o">/</span><span class="nx">test</span><span class="o">-</span><span class="nx">ssl</span><span class="o">-</span><span class="nx">handshakes</span><span class="p">.</span><span class="nx">sh</span> <span class="nx">ratings</span><span class="o">-</span><span class="nx">v1</span><span class="o">-</span><span class="mi">5</span><span class="nx">f867c4bb7</span><span class="o">-</span><span class="mi">7</span><span class="nx">fdv8</span>		<span class="o">&lt;--</span> <span class="nx">NO</span> <span class="nx">HANDSHAKES</span> <span class="nx">TAKE</span> <span class="nx">PLACE</span></span></span></code></pre></div>
<p>KIALI shows a similar behavior (notice no padlock on any of the connections and on the right handside <em>unknown Principals</em> on the from/to).</p>
<p>









  
    
  

  
    
  

  

  

  

  





  


  







<figure>
    <picture>

        
          
          
          
          
          
          
          
          
          
          
          
          
        
          
          
          
          
          
          
          
          
          
          
          
          
        
          
          
          
          
          
          
          
          
          
          
          
          
        

        <img class="image_figure image_internal" src="https://www.wonderingtechie.com/images/20220510/no-security-applied.png" alt="Service Mesh KIALI UI - No mTLS Security" loading="lazy" decoding="async" width="2553" height="1166"  />
      

    </picture>
  </figure>

</p>
<h2 id="enforce-mtls-for-all-applications">Enforce mTLS for all applications</h2>
<p>In the case of a set of applications that require to be excluded from mTLS the above may make sense. However, when the data is sensitive and policy needs to be very strict around security by encryption the Mesh admin can force all components to communicate via <code>mTLS</code> by defining in the <code>SMCP</code> Resource the following mTLS settings.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln">0</span><span class="cl"> <span class="nx">security</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">1</span><span class="cl">    <span class="nx">dataPlane</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">      <span class="nx">automtls</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">      <span class="nx">mtls</span><span class="p">:</span> <span class="kc">true</span></span></span></code></pre></div>
<p>You can also follow this by accessing the <code>SMCP</code> Resource YAML under namespace <code>istio-system</code> and change the existing settings. Alternatively, re-apply the resource at <a href="#setting-up-the-service-mesh-controlplane">Setting up the Service Mesh controlplane</a> changing the settings for <code>mtls: true</code> and <code>automtls: true</code>. The outcome is that the <code>PeerAuthentication</code> resource will now have mTLS set to <code>STRICT</code> mode.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln">0</span><span class="cl"><span class="nx">oc</span> <span class="nx">get</span> <span class="nx">peerauthentication</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">istio</span><span class="o">-</span><span class="nx">system</span>
</span></span><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">NAME</span>                            <span class="nx">MODE</span>         <span class="nx">AGE</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">default</span>                         <span class="nx">STRICT</span>       <span class="mi">5</span><span class="nx">d18h</span></span></span></code></pre></div>
<p>The effect of this configuration is now any request to the <code>productpage</code> will fail.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln"> 0</span><span class="cl"><span class="err">$</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">v</span> <span class="s">&#34;http://$(oc get route istio-ingressgateway -o jsonpath=&#39;{.spec.host}&#39; -n istio-system)/productpage&#34;</span> <span class="p">|</span> <span class="nx">grep</span> <span class="o">-</span><span class="nx">o</span> <span class="s">&#34;&lt;title&gt;.*&lt;/title&gt;&#34;</span>
</span></span><span class="line"><span class="ln"> 1</span><span class="cl"><span class="p">&gt;</span> <span class="nx">Host</span><span class="p">:</span> <span class="nx">istio</span><span class="o">-</span><span class="nx">ingressgateway</span><span class="o">-</span><span class="nx">istio</span><span class="o">-</span><span class="nx">system</span><span class="p">.</span><span class="nx">apps</span><span class="p">.</span><span class="nx">cluster</span><span class="o">-</span><span class="nx">e8e9</span><span class="p">.</span><span class="nx">e8e9</span><span class="p">.</span><span class="nx">sandbox866</span><span class="p">.</span><span class="nx">opentlc</span><span class="p">.</span><span class="nx">com</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">&gt;</span> <span class="nx">User</span><span class="o">-</span><span class="nx">Agent</span><span class="p">:</span> <span class="nx">curl</span><span class="o">/</span><span class="mf">7.71.1</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">&gt;</span> <span class="nx">Accept</span><span class="p">:</span> <span class="o">*/*</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="o">*</span> <span class="nx">Mark</span> <span class="nx">bundle</span> <span class="nx">as</span> <span class="nx">not</span> <span class="nx">supporting</span> <span class="nx">multiuse</span>
</span></span><span class="line hl"><span class="ln"> 6</span><span class="cl"><span class="p">&lt;</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">503</span> <span class="nx">Service</span> <span class="nx">Unavailable</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">&lt;</span> <span class="nx">content</span><span class="o">-</span><span class="nx">length</span><span class="p">:</span> <span class="mi">95</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">&lt;</span> <span class="nx">content</span><span class="o">-</span><span class="kd">type</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">plain</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">&lt;</span> <span class="nx">date</span><span class="p">:</span> <span class="nx">Wed</span><span class="p">,</span> <span class="mi">23</span> <span class="nx">Mar</span> <span class="mi">2022</span> <span class="mi">11</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span> <span class="nx">GMT</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">&lt;</span> <span class="nx">server</span><span class="p">:</span> <span class="nx">istio</span><span class="o">-</span><span class="nx">envoy</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">&lt;</span> <span class="nx">set</span><span class="o">-</span><span class="nx">cookie</span><span class="p">:</span> <span class="mi">44371</span><span class="nx">fc75fdb694d574e56e33b166cc7</span><span class="p">=</span><span class="mi">619</span><span class="nx">f273b9d2709119dd0b6b5b31cdc01</span><span class="p">;</span> <span class="nx">path</span><span class="p">=</span><span class="o">/</span><span class="p">;</span> <span class="nx">HttpOnly</span></span></span></code></pre></div>
<h2 id="mtls-disabled-for-specific-application-workloads">mTLS disabled for specific application workloads</h2>
<p>Our customer had specific workloads (elastic search, kafka streams etc.) which needed to handle their own TLS termination. In this case we wanted to maintain the <code>STRICT</code> policy of mTLS on all traffic except those workloads. To achieve this in the current setup apply the following to disable mTLS ONLY for the <code>details</code> service:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="ln"> 0</span><span class="cl"><span class="nx">oc</span> <span class="nx">delete</span> <span class="nx">dr</span> <span class="nx">productpage</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">oc</span> <span class="nx">delete</span> <span class="nx">dr</span> <span class="nx">productpage</span><span class="o">-</span><span class="mi">2</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">oc</span> <span class="nx">delete</span> <span class="nx">dr</span> <span class="nx">reviews</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">oc</span> <span class="nx">delete</span> <span class="nx">dr</span> <span class="nx">reviews</span><span class="o">-</span><span class="mi">2</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nx">oc</span> <span class="nx">delete</span> <span class="nx">dr</span> <span class="nx">ratings</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nx">oc</span> <span class="nx">delete</span> <span class="nx">dr</span> <span class="nx">ratings</span><span class="o">-</span><span class="mi">2</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">oc</span> <span class="nx">delete</span> <span class="nx">peerauthentication</span> <span class="k">default</span><span class="o">-</span><span class="nx">disable</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nx">echo</span> <span class="s">&#34;apiVersion: security.istio.io/v1beta1
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="s">kind: PeerAuthentication
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="s">  name: details-mtls-disable
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="s">  namespace: bookinfo
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="s">  selector:
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="s">    matchLabels:
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="s">      app: details
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="s">  mtls:
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="s">    mode: DISABLE&#34;</span> <span class="p">|</span><span class="nx">oc</span> <span class="nx">apply</span> <span class="o">-</span><span class="nx">n</span> <span class="nx">bookinfo</span> <span class="o">-</span><span class="nx">f</span> <span class="o">-</span></span></span></code></pre></div>
<p>Testing should show the following in KIALI UI where a padlock appears in all connections except the <code>details</code> and <em>Principal</em> shows content of the certs used on the from/to now) whilst you can also check the <a href="https://github.com/skoussou/servicemesh-playground/tree/main/Scenario-MTLS-4-Turn-Off-MTLS#anchor-1">istio-proxy handshake stats</a> once more to verify TLS handshakes do take place for all workloads except <code>details</code>.</p>
<p>









  
    
  

  
    
  

  

  

  

  





  


  







<figure>
    <picture>

        
          
          
          
          
          
          
          
          
          
          
          
          
        
          
          
          
          
          
          
          
          
          
          
          
          
        
          
          
          
          
          
          
          
          
          
          
          
          
        

        <img class="image_figure image_internal" src="https://www.wonderingtechie.com/images/20220510/all-but-details-with-mtls.png" alt="Service Mesh KIALI UI - No mTLS for details service" loading="lazy" decoding="async" width="2559" height="1257"  />
      

    </picture>
  </figure>

</p>
<p>Final thoughts around the behavior of mTLS <strong>on</strong> or <strong>off</strong> in the OSSM</p>
<ul>
<li>If <code>SMCP</code> Resource config is set to <code>PERMISSIVE</code> mTLS the above additional <code>PeerAuthentication</code> for details is not required.</li>
<li>If <code>SMCP</code> Resource config is set to <code>STRICT</code> mTLS the above additional <code>PeerAuthentication</code> for details is required and if removed the result will be as follows</li>
</ul>
<p>









  
    
  

  
    
  

  

  

  

  





  


  







<figure>
    <picture>

        
          
          
          
          
          
          
          
          
          
          
          
          
        
          
          
          
          
          
          
          
          
          
          
          
          
        
          
          
          
          
          
          
          
          
          
          
          
          
        

        <img class="image_figure image_internal" src="https://www.wonderingtechie.com/images/20220510/error-without-peerauthentication-disable.png" alt="Service Mesh KIALI UI -  Error for STRICT mTLS when no PeerAuthentication DISABLE is defined" loading="lazy" decoding="async" width="2556" height="1161"  />
      

    </picture>
  </figure>

</p>
<h2 id="conclusion">Conclusion</h2>
<p>The Red Hat OpenShift Service Mesh (OSSM) will always apply mTLS encryption to the traffic and the options are if it should be <code>STRICT</code> or <code>PERMISSIVE</code>. In the <code>STRICT</code> case, all traffic participating workloads will be required to have the ability to adhere to this policy or be explicitly excluded through a <code>PeerAuthentication</code> disable policy for that service. In the <code>PERMISSIVE</code> scenario workloads will participate in mTLS traffic if both parties can and this can be by-passed via a <code>DestinationRule</code> for informing all clients of the host of a service to not initiate mTLS connection.</p>
<p>You can try all above examples (and more) in the <a href="https://github.com/skoussou/servicemesh-playground">servicemesh-playground</a> repository and provide feedback.</p>

    </div>
<div class="post_comments">
  
  
  
</div>



  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
        <h2>Stelios Kousouris</h2>
      <div class="author_bio">
        Technologist, Enthusiast Application Developer, Mentor, lifelong learner, avid fisherman
      </div>
      <a href='https://www.wonderingtechie.com/about/' class="button mt-1" role="button" title='Read More'>Read More</a>

    
    
    <h2 class="mt-4">Recent Posts</h2>
    <ul class="flex-column">
      <li>
        <a href="https://www.wonderingtechie.com/post/2022/ossm-security-with-mtls-for-egress-edge-traffic/" class="nav-link" title="Red Hat OpenShift Service Mesh (OSSM) - Security options with mTLS for egress edge traffic">Red Hat OpenShift Service Mesh (OSSM) - Security options with mTLS for egress edge traffic</a>
      </li>
      <li>
        <a href="https://www.wonderingtechie.com/post/2022/ossm-federation-scripted/" class="nav-link" title="Red Hat Openshift Service Mesh - Federation Automated Setup">Red Hat Openshift Service Mesh - Federation Automated Setup</a>
      </li>
      <li>
        <a href="https://www.wonderingtechie.com/post/2022/part-3-application-trouble-in-the-cloud-application-functional-issues/" class="nav-link" title="Part 3 - Application Troubles in the Cloud (Symptom: Application Functional Problems)">Part 3 - Application Troubles in the Cloud (Symptom: Application Functional Problems)</a>
      </li>
      <li>
        <a href="https://www.wonderingtechie.com/post/2022/part-2-application-trouble-in-the-cloud-servicemesh-app-performance/" class="nav-link" title="Part 2 - Application Troubles in the Cloud (Symptom: Performance Problems whilst part of a Service Mesh)">Part 2 - Application Troubles in the Cloud (Symptom: Performance Problems whilst part of a Service Mesh)</a>
      </li>
      <li>
        <a href="https://www.wonderingtechie.com/post/2022/part-1-application-trouble-in-the-cloud-pod-restarts/" class="nav-link" title="Part 1 - Application Troubles in the Cloud (Symptom: Kubernetes POD Failures or often Restarts)">Part 1 - Application Troubles in the Cloud (Symptom: Kubernetes POD Failures or often Restarts)</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categories</h2>
      <nav class="tags_nav">
        <a href='https://www.wonderingtechie.com/categories/openshift/' class="post_tag button button_translucent" title="openshift">
          OPENSHIFT
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://www.wonderingtechie.com/categories/servicemesh/' class="post_tag button button_translucent" title="servicemesh">
          SERVICEMESH
          <span class="button_tally">3</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="series-section">Series</h2>
      <nav class="tags_nav">
        <a href='https://www.wonderingtechie.com/series/cloud-apps-troubleshoot/' class="post_tag button button_translucent" title="cloud-apps-troubleshoot">
          CLOUD-APPS-TROUBLESHOOT
          <span class="button_tally">3</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='https://www.wonderingtechie.com/tags/openshift/' class="post_tag button button_translucent" title="openshift">
          OPENSHIFT
          <span class="button_tally">6</span>
        </a>
        
        <a href='https://www.wonderingtechie.com/tags/cloudapps/' class="post_tag button button_translucent" title="cloudapps">
          CLOUDAPPS
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://www.wonderingtechie.com/tags/ossm/' class="post_tag button button_translucent" title="ossm">
          OSSM
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://www.wonderingtechie.com/tags/servicemesh/' class="post_tag button button_translucent" title="servicemesh">
          SERVICEMESH
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://www.wonderingtechie.com/tags/troubleshooting/' class="post_tag button button_translucent" title="troubleshooting">
          TROUBLESHOOTING
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://www.wonderingtechie.com/tags/index/' class="post_tag button button_translucent" title="index">
          INDEX
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://www.wonderingtechie.com/tags/mtls/' class="post_tag button button_translucent" title="mtls">
          MTLS
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="years-section">Posts by Year</h2>
      <nav class="tags_nav">
        <a href='https://www.wonderingtechie.com/years/2022/' class="post_tag button button_translucent" title="2022">
          2022
          <span class="button_tally">6</span>
        </a>
        
        
      </nav>
    </div>
  </section>
</aside>

  
</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/> 
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="arrow">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing">
    <path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/>
  </symbol>
</svg>


<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='https://www.wonderingtechie.com/icons/favicon-thewonderingtechie.png' class="icon icon_2 transparent" alt="The Wondering Techie">
    <p>Copyright&nbsp;<span class="year"></span>&nbsp;THE WONDERING TECHIE. All Rights Reserved</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <use xlink:href="#arrow"></use>
</svg>
</a>

  </div>
</footer>

    <script type="text/javascript" src="https://www.wonderingtechie.com/js/bundle.min.38de1519efd9f00810f37ccedfa6aa9db3c9e361f8a8d81b181268bcab092ae8382d9648a9e95dd34c9ec5b39af512289496224f286cd45115ef11ac40b34d7a.js" integrity="sha512-ON4VGe/Z8AgQ83zO36aqnbPJ42H4qNgbGBJovKsJKug4LZZIqeld00yexbOa9RIolJYiTyhs1FEV7xGsQLNNeg==" crossorigin="anonymous"></script>
    
  </body>
</html>
